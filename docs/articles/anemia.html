<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anemia prevalence among women: an <code>rdhs</code> example â€¢ rdhs</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Anemia prevalence among women: an &lt;code&gt;rdhs&lt;/code&gt; example">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rdhs</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/introduction.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to rdhs (Overview)</a>
    </li>
    <li>
      <a href="../articles/anemia.html">An example use case looking at trends in anemia</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OJWatson/rdhs">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Anemia prevalence among women: an <code>rdhs</code> example</h1>
                        <h4 class="author">OJ Watson, Jeff Eaton</h4>
            
            <h4 class="date">2018-04-14</h4>
      
      
      <div class="hidden name"><code>anemia.Rmd</code></div>

    </div>

    
    
<p>Anemia is a common cause of fatigue, and women of childbearing age are at particularly high risk for anemia. The package <code>rdhs</code> can be used to compare estimates of the prevalence of any anemia among women from Demographic and Health Surveys (DHS) conducted in Armenia, Cambodia, and Lesotho.</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>Load the <code>rdhs</code> package and other useful packages for analysing data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#devtools::install_github("OJWatson/rdhs")</span>
<span class="kw">library</span>(rdhs)
<span class="kw">library</span>(data.table)</code></pre></div>
<pre><code>## Warning: package 'data.table' was built under R version 3.4.3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)</code></pre></div>
<pre><code>## Warning: package 'ggplot2' was built under R version 3.4.3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survey)
<span class="kw">library</span>(haven)</code></pre></div>
</div>
<div id="using-calculated-indicators-from-statcompiler" class="section level1">
<h1 class="hasAnchor">
<a href="#using-calculated-indicators-from-statcompiler" class="anchor"></a>Using calculated indicators from STATcompiler</h1>
<p>Anemia prevalence among women is reported as a core indicator through the DHS STATcompiler (<a href="https://www.statcompiler.com/" class="uri">https://www.statcompiler.com/</a>). These indicators can be accessed directly from R via the DHS API with the function <code><a href="../reference/dhs_data.html">dhs_data()</a></code>.</p>
<p>Query the API for a list of all StatCompiler indicators, and then search the indicators for those that have <code>"anemia"</code> in the indicator name. API calls return <code>data.table</code> objects. If package <code>data.table</code> is not loaded, they will be printed as <code>data.frame</code>s instead.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rdhs)

indicators &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dhs_indicators.html">dhs_indicators</a></span>()
<span class="kw">tail</span>(indicators[<span class="kw">grepl</span>(<span class="st">"anemia"</span>, Label), .(IndicatorId, ShortName, Label)])</code></pre></div>
<pre><code>##      IndicatorId                 ShortName                       Label
## 1: CN_ANMC_C_SEV Severe anemia (&lt;7.0 g/dl) Children with severe anemia
## 2: AN_ANEM_W_ANY                      Any        Women with any anemia
## 3: AN_ANEM_W_MLD                     Mild       Women with mild anemia
## 4: AN_ANEM_W_MOD                 Moderate   Women with moderate anemia
## 5: AN_ANEM_W_SEV                   Severe     Women with severe anemia
## 6: AN_ANEM_M_ANY                Any anemia         Men with any anemia</code></pre>
<p>The indicator ID <code>"AN_ANEM_W_ANY"</code> reports the percentage of women with any anemia. The function <code><a href="../reference/dhs_data.html">dhs_data()</a></code> will query the indicator dataset for the value of this indicator for our three countries of interest. First, use <code><a href="../reference/dhs_countries.html">dhs_countries()</a></code> to query the list of DHS countries to identify the DHS country code for each country.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">countries &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dhs_countries.html">dhs_countries</a></span>()
dhscc &lt;-<span class="st"> </span>countries[CountryName %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">"Armenia"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Lesotho"</span>), DHS_CountryCode]
dhscc</code></pre></div>
<pre><code>## [1] "AM" "KH" "LS"</code></pre>
<p>Now query the indicators dataset for the women with any anemia indicator for these three countries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">statcomp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dhs_data.html">dhs_data</a></span>(<span class="dt">indicatorIds =</span> <span class="st">"AN_ANEM_W_ANY"</span>, <span class="dt">countryIds =</span> dhscc)
statcomp[,.(Indicator, CountryName, SurveyYear, Value, DenominatorWeighted)]</code></pre></div>
<pre><code>##                 Indicator CountryName SurveyYear Value DenominatorWeighted
##  1: Women with any anemia     Armenia       2000  12.4                6137
##  2: Women with any anemia     Armenia       2005  24.6                6080
##  3: Women with any anemia     Armenia       2016  13.4                5769
##  4: Women with any anemia    Cambodia       2000  58.8                3634
##  5: Women with any anemia    Cambodia       2005  46.7                8219
##  6: Women with any anemia    Cambodia       2010  44.4                9229
##  7: Women with any anemia    Cambodia       2014  45.4               11286
##  8: Women with any anemia     Lesotho       2004  32.9                3008
##  9: Women with any anemia     Lesotho       2009  26.3                3839
## 10: Women with any anemia     Lesotho       2014  27.3                3297</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(statcomp, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(SurveyYear, Value, <span class="dt">col=</span>CountryName)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>()</code></pre></div>
<p><img src="anemia_files/figure-html/unnamed-chunk-4-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div id="analyse-dhs-microdata" class="section level1">
<h1 class="hasAnchor">
<a href="#analyse-dhs-microdata" class="anchor"></a>Analyse DHS microdata</h1>
<div id="identify-surveys-that-include-anemia-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-surveys-that-include-anemia-testing" class="anchor"></a>Identify surveys that include anemia testing</h2>
<p>The DHS API provides the facility to filter surveys according to particular characteristics. We first query the list of survey characteristics and identify the <code>SurveyCharacteristicID</code> that indicates the survey included anemia testing. The first command below queries the API for the full liest of survey characteristics, and the second uses <code>grepl()</code> to search <code>SurveyCharacteristicName</code>s that include the word â€˜anemiaâ€™.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">surveychar &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dhs_surveyCharacteristics.html">dhs_surveyCharacteristics</a></span>()
surveychar[<span class="kw">grepl</span>(<span class="st">"anemia"</span>, SurveyCharacteristicName, <span class="dt">ignore.case=</span><span class="ot">TRUE</span>)]</code></pre></div>
<pre><code>##    SurveyCharacteristicID SurveyCharacteristicName
## 1:                     15         Anemia questions
## 2:                     41           Anemia testing</code></pre>
<p>The <code>SurveyCharacteristicID = 41</code> indicates that the survey included anemia testing. Next we query the API to identify the surveys that have this characteristic and were conducted in our countries of interest.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">surveys &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dhs_surveys.html">dhs_surveys</a></span>(<span class="dt">surveyCharacteristicIds =</span> <span class="dv">41</span>, <span class="dt">countryIds =</span> dhscc)
surveys[,.(SurveyId, CountryName, SurveyYear, NumberOfWomen, SurveyNum, FieldworkEnd)]</code></pre></div>
<pre><code>##      SurveyId CountryName SurveyYear NumberOfWomen SurveyNum FieldworkEnd
##  1: AM2000DHS     Armenia       2000          6430       203   2000-12-01
##  2: AM2005DHS     Armenia       2005          6566       262   2005-12-01
##  3: AM2016DHS     Armenia       2016          6116       492   2016-04-01
##  4: KH2000DHS    Cambodia       2000         15351       140   2000-07-01
##  5: KH2005DHS    Cambodia       2005         16823       257   2006-03-01
##  6: KH2010DHS    Cambodia       2010         18754       310   2011-01-01
##  7: KH2014DHS    Cambodia       2014         17578       464   2014-12-01
##  8: LS2004DHS     Lesotho       2004          7095       256   2005-01-01
##  9: LS2009DHS     Lesotho       2009          7624       317   2010-01-01
## 10: LS2014DHS     Lesotho       2014          6621       462   2014-12-01</code></pre>
<p>Finally, query the API identify the individual recode (IR) survey datasets for each of these surveys</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datasets &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dhs_datasets.html">dhs_datasets</a></span>(<span class="dt">surveyIds =</span> surveys$SurveyId, <span class="dt">fileType =</span> <span class="st">"IR"</span>, <span class="dt">fileFormat=</span><span class="st">"flat"</span>)
datasets[, .(SurveyId, SurveyNum, FileDateLastModified, FileName)]</code></pre></div>
<pre><code>##      SurveyId SurveyNum        FileDateLastModified     FileName
##  1: AM2000DHS       203   October, 05 2006 14:22:40 AMIR42FL.ZIP
##  2: AM2005DHS       262  February, 02 2010 10:38:12 AMIR54FL.zip
##  3: AM2016DHS       492 September, 21 2017 16:10:15 AMIR71FL.ZIP
##  4: KH2000DHS       140   October, 08 2007 12:31:53 KHIR42FL.zip
##  5: KH2005DHS       257   October, 18 2011 13:53:19 KHIR51FL.zip
##  6: KH2010DHS       310   October, 26 2011 11:11:07 KHIR61FL.ZIP
##  7: KH2014DHS       464      July, 28 2017 10:58:10 KHIR73FL.ZIP
##  8: LS2004DHS       256      July, 31 2007 13:14:31 LSIR41FL.ZIP
##  9: LS2009DHS       317  November, 10 2015 10:51:05 LSIR61FL.ZIP
## 10: LS2014DHS       462      June, 14 2016 11:35:19 LSIR71FL.ZIP</code></pre>
</div>
<div id="download-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#download-datasets" class="anchor"></a>Download datasets</h2>
<p>To get datasets, we establish a <code>client_dhs</code> object. The DHS client creates a cache in a specified location to save downloaded datasets and metatdata. The client requires login credentials for accessing datasets from the DHS website, including the email address, password, and project name. Credentials should be stored in a text file with three lines:</p>
<pre><code>email=dummy@gmail.com
password=dummypass
project=Dummy Project Name</code></pre>
<p>The file path to to this credentials file and the desired location for the cache are passed to the <code><a href="../reference/client_dhs.html">client_dhs()</a></code> function to establish the DHS client.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">client &lt;-<span class="st"> </span><span class="kw"><a href="../reference/client_dhs.html">client_dhs</a></span>(<span class="dt">credentials =</span> <span class="st">"credentials"</span>,
                     <span class="dt">root =</span> <span class="kw">file.path</span>(<span class="kw">path.expand</span>(<span class="st">'~'</span>),<span class="st">'rdhs_cache'</span>))</code></pre></div>
<p>After establishing the client, the function <code>client$get_datasets()</code> returns a list of file paths where the desired datasets are saved in the cache. The first time a dataset is accessed, the client will download the dataset from the DHS program website using the supplied credentials. Subsequently, datasets will be simply be located in the cached repository.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datasets$path &lt;-<span class="st"> </span><span class="kw">unlist</span>(client$<span class="kw">get_datasets</span>(datasets$FileName))</code></pre></div>
</div>
<div id="identify-survey-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#identify-survey-variables" class="anchor"></a>Identify survey variables</h2>
<p>Anemia is defined as having a hemoglobin (Hb) &lt;12.0 g/dL for non-pregnant women or Hb &lt;11.0 g/dL for currently pregnant women<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. To calculate anemia prevalence from DHS microdata, we must identify the DHS recode survey variables for hemoglobin measurement and pregnancy status. This could be done by consulting the DHS recode manual or the .MAP files accompanying survey datasets. It is convenient though to do this in R by loading the first individual recode dataset and searching the metadata for the variable names corresponding to the hemoglobin measurement and pregnancy status.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(client$<span class="kw">survey_questions</span>(datasets$FileName[<span class="dv">10</span>], <span class="st">"hemoglobin"</span>)[,<span class="dv">1</span>:<span class="dv">2</span>])</code></pre></div>
<pre><code>##   variable
## 1     v042
## 2    v452c
## 3     v453
## 4     v455
## 5     v456
## 6   hw52_1
##                                                             description
## 1                                     Household selected for hemoglobin
## 2                                   Read consent statement - hemoglobin
## 3                                   Hemoglobin level (g/dl - 1 decimal)
## 4                                    Result of measurement - hemoglobin
## 5 Hemoglobin level adjusted for altitude and smoking (g/dl - 1 decimal)
## 6                                   Read consent statement - hemoglobin</code></pre>
<p>Variable <code>v042</code> records the household selection for hemoglobin testing. Variable <code>v455</code> reports the outcome of hemoglobin measurement and <code>v456</code> the result of altitude adjusted hemoglobin levels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ir &lt;-<span class="st"> </span><span class="kw">readRDS</span>(datasets$path[<span class="dv">10</span>])
<span class="kw">table</span>(<span class="kw">as_factor</span>(ir$v042))</code></pre></div>
<pre><code>## 
## not selected     selected 
##         3203         3418</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(<span class="kw">as_factor</span>(ir$v455))</code></pre></div>
<pre><code>## 
##                          measured                       not present 
##                              3349                                 2 
##                           refused                             other 
##                                35                                 8 
## no measurement found in household                           missing 
##                                 0                                24</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(ir$v456)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    24.0   118.0   130.0   145.6   141.0   999.0    3203</code></pre>
<p>Variable <code>v454</code> reports the current pregnancy status used for determining the anemia threshold.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">client$<span class="kw">survey_questions</span>(datasets$FileName[<span class="dv">1</span>], <span class="st">"currently.*pregnant"</span>)[,<span class="dv">1</span>:<span class="dv">2</span>]</code></pre></div>
<pre><code>##   variable        description
## 1     v213 Currently pregnant
## 2     v454 Currently pregnant</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(<span class="kw">as_factor</span>(ir$v454))</code></pre></div>
<pre><code>## 
## no/don't know           yes       missing 
##          3276           142             0</code></pre>
<p>We also keep a number of other variables related to the survey design and potentially interesting covariates: country code and phase (<code>v000</code>), cluster number (<code>v001</code>), sample weight (<code>v005</code>), age (<code>v012</code>), region (<code>v024</code>), urban/rural residence (<code>v025</code>), and education level (<code>v106</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"SurveyId"</span>, <span class="st">"CountryName"</span>, <span class="st">"SurveyYear"</span>, <span class="st">"v000"</span>, <span class="st">"v001"</span>, <span class="st">"v005"</span>,
          <span class="st">"v012"</span>, <span class="st">"v024"</span>, <span class="st">"v025"</span>, <span class="st">"v106"</span>, <span class="st">"v042"</span>, <span class="st">"v454"</span>, <span class="st">"v455"</span>, <span class="st">"v456"</span>)</code></pre></div>
</div>
<div id="extract-survey-data" class="section level2">
<h2 class="hasAnchor">
<a href="#extract-survey-data" class="anchor"></a>Extract survey data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datlst &lt;-<span class="st"> </span><span class="kw">list</span>()

for(i in <span class="dv">1</span>:<span class="kw">nrow</span>(datasets)){

  if(<span class="kw">file.exists</span>(datasets$path[i])){
  
  <span class="kw">print</span>(<span class="kw">paste</span>(i, datasets$SurveyId[i]))
  ir &lt;-<span class="st"> </span><span class="kw">readRDS</span>(datasets$path[i])

  ir$SurveyId &lt;-<span class="st"> </span>datasets$SurveyId[i]
  ir$CountryName &lt;-<span class="st"> </span>datasets$CountryName[i]
  ir$SurveyYear &lt;-<span class="st"> </span>datasets$SurveyYear[i]

  datlst[[datasets$SurveyId[i]]] &lt;-<span class="st"> </span>ir[vars]
  }
}</code></pre></div>
<pre><code>## [1] "1 AM2000DHS"
## [1] "2 AM2005DHS"
## [1] "3 AM2016DHS"
## [1] "4 KH2000DHS"
## [1] "5 KH2005DHS"
## [1] "6 KH2010DHS"
## [1] "7 KH2014DHS"
## [1] "8 LS2004DHS"
## [1] "9 LS2009DHS"
## [1] "10 LS2014DHS"</code></pre>
<p>We use <code><a href="../reference/rbind_labelled.html">rbind_labelled()</a></code> to combine datasets with labelled columns. The argument <code>labels</code> describes to combine variable levels for all datasets for <code>v024</code> (region) while providing a consistent set of value labels to be used for <code>v454</code> (currently pregnant) for all datasets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rbind_labelled.html">rbind_labelled</a></span>(datlst,
                      <span class="dt">labels =</span> <span class="kw">list</span>(<span class="dt">v024 =</span> <span class="st">"concatenate"</span>,
                                    <span class="dt">v454 =</span> <span class="kw">c</span>(<span class="st">"no/don't know"</span> =<span class="st"> </span>0L,
                                             <span class="st">"yes"</span> =<span class="st"> </span>1L, <span class="st">"missing"</span> =<span class="st"> </span>9L)))</code></pre></div>
<pre><code>## Warning in rbind_labelled(datlst, labels = list(v024 = "concatenate", v454 = c(`no/don't know` = 0L, : Some variables have non-matching value labels: v106, v455, v456.
## Inheriting labels from first data frame.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(dat, is.labelled)</code></pre></div>
<pre><code>##    SurveyId CountryName  SurveyYear        v000        v001        v005 
##       FALSE       FALSE       FALSE       FALSE       FALSE       FALSE 
##        v012        v024        v025        v106        v042        v454 
##       FALSE        TRUE        TRUE        TRUE        TRUE        TRUE 
##        v455        v456     DATASET 
##        TRUE        TRUE       FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat$v456 &lt;-<span class="st"> </span><span class="kw">zap_labels</span>(dat$v456)
dat &lt;-<span class="st"> </span><span class="kw">as_factor</span>(dat)</code></pre></div>
</div>
<div id="data-tabulations" class="section level2">
<h2 class="hasAnchor">
<a href="#data-tabulations" class="anchor"></a>Data tabulations</h2>
<p>It is a good idea to check basic tabulations of the data, especially by survey to identify and nuances Exploratory analysis of variables</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(dat, <span class="kw">table</span>(SurveyId, v025, <span class="dt">useNA=</span><span class="st">"ifany"</span>))</code></pre></div>
<pre><code>##            v025
## SurveyId    urban rural
##   AM2000DHS  3545  2885
##   AM2005DHS  4592  1974
##   AM2016DHS  3545  2571
##   KH2000DHS  2627 12724
##   KH2005DHS  4152 12671
##   KH2010DHS  6077 12677
##   KH2014DHS  5667 11911
##   LS2004DHS  1945  5150
##   LS2009DHS  1977  5647
##   LS2014DHS  2202  4419</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(dat, <span class="kw">table</span>(SurveyId, v106, <span class="dt">useNA=</span><span class="st">"ifany"</span>))</code></pre></div>
<pre><code>##            v106
## SurveyId    no education primary secondary higher missing
##   AM2000DHS            5      24      5329   1072       0
##   AM2005DHS            7      24      5138   1397       0
##   AM2016DHS            5     406      2580   3125       0
##   KH2000DHS         4849    8182      2276     44       0
##   KH2005DHS         3772    9131      3771    149       0
##   KH2010DHS         3203    8796      6141    614       0
##   KH2014DHS         2233    7826      6535    984       0
##   LS2004DHS          169    4309      2520     97       0
##   LS2009DHS          114    3865      3277    368       0
##   LS2014DHS           81    2665      3354    521       0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(dat, <span class="kw">table</span>(SurveyId, v454, <span class="dt">useNA=</span><span class="st">"ifany"</span>))</code></pre></div>
<pre><code>##            v454
## SurveyId    no/don't know   yes missing  &lt;NA&gt;
##   AM2000DHS          6231   199       0     0
##   AM2005DHS          5967   158     441     0
##   AM2016DHS          5939   177       0     0
##   KH2000DHS          3312   296      62 11681
##   KH2005DHS          7685   501     212  8425
##   KH2010DHS          8906   475       0  9373
##   KH2014DHS         10883   663       0  6032
##   LS2004DHS          2857   203       0  4035
##   LS2009DHS          3740   173     103  3608
##   LS2014DHS          3276   142       0  3203</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(dat, <span class="kw">table</span>(SurveyId, v455, <span class="dt">useNA=</span><span class="st">"ifany"</span>))</code></pre></div>
<pre><code>##            v455
## SurveyId    measured not present refused other no measurement found in hh
##   AM2000DHS     6137           5     264    24                          0
##   AM2005DHS     6134           8     294     1                          0
##   AM2016DHS     5807          11     295     0                          0
##   KH2000DHS     3666           0      68     0                          0
##   KH2005DHS     8182           2     185     5                          0
##   KH2010DHS     9225           9     106     0                          0
##   KH2014DHS    11390           8      13     2                          0
##   LS2004DHS     3061          15     377    56                          0
##   LS2009DHS     3896           1      78     5                          0
##   LS2014DHS     3349           2      35     8                          0
##            v455
## SurveyId    missing  &lt;NA&gt;
##   AM2000DHS       0     0
##   AM2005DHS     129     0
##   AM2016DHS       3     0
##   KH2000DHS       3 11614
##   KH2005DHS      24  8425
##   KH2010DHS      41  9373
##   KH2014DHS     133  6032
##   LS2004DHS      29  3557
##   LS2009DHS      36  3608
##   LS2014DHS      24  3203</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(dat, <span class="kw">table</span>(v042, v454, <span class="dt">useNA=</span><span class="st">"ifany"</span>))</code></pre></div>
<pre><code>##               v454
## v042           no/don't know   yes missing  &lt;NA&gt;
##   not selected             0     0       0 45778
##   selected             58796  2987     818   579</code></pre>
</div>
<div id="calculate-anemia-prevalence" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-anemia-prevalence" class="anchor"></a>Calculate anemia prevalence</h2>
<p>Create indicator variable for â€˜any anemiaâ€™. The threshold depends on pregnancy status.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat$v456[dat$v456 ==<span class="st"> </span><span class="dv">999</span>] &lt;-<span class="st"> </span><span class="ot">NA</span>
<span class="kw">with</span>(dat, <span class="kw">table</span>(v455, <span class="kw">is.na</span>(v456)))</code></pre></div>
<pre><code>##                             
## v455                         FALSE  TRUE
##   measured                   60847     0
##   not present                    0    61
##   refused                        0  1715
##   other                          0   101
##   no measurement found in hh     0     0
##   missing                        0   422</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat$anemia &lt;-<span class="st"> </span><span class="kw">as.integer</span>(dat$v456  &lt;<span class="st"> </span><span class="kw">ifelse</span>(dat$v454 ==<span class="st"> "yes"</span>, <span class="dv">110</span>, <span class="dv">120</span>))
dat$anemia_denom &lt;-<span class="st"> </span><span class="kw">as.integer</span>(!<span class="kw">is.na</span>(dat$anemia))</code></pre></div>
<p>Specify survey design using the <code>survey</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat$w &lt;-<span class="st"> </span>dat$v005/<span class="fl">1e6</span>
des &lt;-<span class="st"> </span><span class="kw">svydesign</span>(~v001+SurveyId, <span class="dt">data=</span>dat, <span class="dt">weights=</span>~w)

anemia_prev &lt;-<span class="st"> </span><span class="kw">svyby</span>(~anemia, ~SurveyId, des, svyciprop, <span class="dt">na.rm=</span><span class="ot">TRUE</span>, <span class="dt">vartype=</span><span class="st">"ci"</span>)
anemia_denom &lt;-<span class="st"> </span><span class="kw">svyby</span>(~anemia_denom, ~SurveyId, des, svytotal, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)

anemia_prev &lt;-<span class="st"> </span><span class="kw">merge</span>(anemia_prev, anemia_denom[<span class="kw">c</span>(<span class="st">"SurveyId"</span>, <span class="st">"anemia_denom"</span>)])
res &lt;-<span class="st"> </span>statcomp[,.(SurveyId, CountryName, SurveyYear, Value, DenominatorUnweighted, DenominatorWeighted)][anemia_prev, on=<span class="st">"SurveyId"</span>]

res$anemia &lt;-<span class="st"> </span><span class="dv">100</span>*res$anemia
res$ci_l &lt;-<span class="st"> </span><span class="dv">100</span>*res$ci_l
res$ci_u &lt;-<span class="st"> </span><span class="dv">100</span>*res$ci_u
res$anemia_denom0 &lt;-<span class="st"> </span><span class="kw">round</span>(res$anemia_denom)</code></pre></div>
<p>The table below compares the prevalence of any anemia calcuated from survey microdata with the estimates from DHS StatCompiler and the weighted denominators for each calculation. The estimates are identical for most cases. There are some small differences to be ironed out, which will require looking at the specific coutnries to check how their stratification was carried out. (We are hoping to bring this feature in once the DHS program has compiled how sample strata were constructed for all of their studies).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr::<span class="kw">kable</span>(res[,.(CountryName, SurveyYear, Value, anemia, ci_l, ci_u, DenominatorWeighted, anemia_denom0)], <span class="dt">digits=</span><span class="dv">1</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">CountryName</th>
<th align="right">SurveyYear</th>
<th align="right">Value</th>
<th align="right">anemia</th>
<th align="right">ci_l</th>
<th align="right">ci_u</th>
<th align="right">DenominatorWeighted</th>
<th align="right">anemia_denom0</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Armenia</td>
<td align="right">2000</td>
<td align="right">12.4</td>
<td align="right">11.7</td>
<td align="right">10.6</td>
<td align="right">13.0</td>
<td align="right">6137</td>
<td align="right">6137</td>
</tr>
<tr class="even">
<td align="left">Armenia</td>
<td align="right">2005</td>
<td align="right">24.6</td>
<td align="right">23.1</td>
<td align="right">21.3</td>
<td align="right">24.9</td>
<td align="right">6080</td>
<td align="right">6080</td>
</tr>
<tr class="odd">
<td align="left">Armenia</td>
<td align="right">2016</td>
<td align="right">13.4</td>
<td align="right">13.4</td>
<td align="right">11.8</td>
<td align="right">15.3</td>
<td align="right">5769</td>
<td align="right">5769</td>
</tr>
<tr class="even">
<td align="left">Cambodia</td>
<td align="right">2000</td>
<td align="right">58.8</td>
<td align="right">58.8</td>
<td align="right">56.6</td>
<td align="right">60.9</td>
<td align="right">3634</td>
<td align="right">3634</td>
</tr>
<tr class="odd">
<td align="left">Cambodia</td>
<td align="right">2005</td>
<td align="right">46.7</td>
<td align="right">46.7</td>
<td align="right">44.9</td>
<td align="right">48.5</td>
<td align="right">8219</td>
<td align="right">8219</td>
</tr>
<tr class="even">
<td align="left">Cambodia</td>
<td align="right">2010</td>
<td align="right">44.4</td>
<td align="right">44.4</td>
<td align="right">42.8</td>
<td align="right">46.0</td>
<td align="right">9229</td>
<td align="right">9229</td>
</tr>
<tr class="odd">
<td align="left">Cambodia</td>
<td align="right">2014</td>
<td align="right">45.4</td>
<td align="right">45.4</td>
<td align="right">44.1</td>
<td align="right">46.7</td>
<td align="right">11286</td>
<td align="right">11286</td>
</tr>
<tr class="even">
<td align="left">Lesotho</td>
<td align="right">2004</td>
<td align="right">32.9</td>
<td align="right">32.7</td>
<td align="right">30.5</td>
<td align="right">35.1</td>
<td align="right">3008</td>
<td align="right">2789</td>
</tr>
<tr class="odd">
<td align="left">Lesotho</td>
<td align="right">2009</td>
<td align="right">26.3</td>
<td align="right">25.5</td>
<td align="right">23.8</td>
<td align="right">27.4</td>
<td align="right">3839</td>
<td align="right">3839</td>
</tr>
<tr class="even">
<td align="left">Lesotho</td>
<td align="right">2014</td>
<td align="right">27.3</td>
<td align="right">27.3</td>
<td align="right">25.2</td>
<td align="right">29.4</td>
<td align="right">3297</td>
<td align="right">3297</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(res, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>SurveyYear, <span class="dt">y=</span>anemia, <span class="dt">ymin=</span>ci_l, <span class="dt">ymax=</span>ci_u,
                <span class="dt">col=</span>CountryName, <span class="dt">fill=</span>CountryName)) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_ribbon">geom_ribbon</a></span>(<span class="dt">alpha=</span><span class="fl">0.4</span>, <span class="dt">linetype=</span><span class="st">"blank"</span>) +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>()</code></pre></div>
<p><img src="anemia_files/figure-html/unnamed-chunk-19-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="regression-analysis-relationship-between-education-and-anemia" class="section level1">
<h1 class="hasAnchor">
<a href="#regression-analysis-relationship-between-education-and-anemia" class="anchor"></a>Regression analysis: relationship between education and anemia</h1>
<p>A key use of the survey microdata are to conduct secondary analysis of pooled data from several surveys, such as regression analysis. Here we investigate the relationship between anemia prevalence and education level (<code>v106</code>) for women using logistic regression, adjusting for urban/rural (<code>v025</code>) and fixed effects for each survey.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des &lt;-<span class="st"> </span><span class="kw">update</span>(des, <span class="dt">v106 =</span> <span class="kw">relevel</span>(v106, <span class="st">"primary"</span>))
<span class="kw">summary</span>(<span class="kw">svyglm</span>(anemia ~<span class="st"> </span>SurveyId +<span class="st"> </span>v025 +<span class="st"> </span>v106, des, <span class="dt">family=</span><span class="st">"binomial"</span>))</code></pre></div>
<pre><code>## Warning in eval(family$initialize): non-integer #successes in a binomial
## glm!</code></pre>
<pre><code>## 
## Call:
## svyglm(formula = anemia ~ SurveyId + v025 + v106, des, family = "binomial")
## 
## Survey design:
## update(des, v106 = relevel(v106, "primary"))
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       -1.91019    0.06478 -29.489  &lt; 2e-16 ***
## SurveyIdAM2005DHS  0.82908    0.08086  10.253  &lt; 2e-16 ***
## SurveyIdAM2016DHS  0.21583    0.09571   2.255 0.024488 *  
## SurveyIdKH2000DHS  2.14550    0.07503  28.596  &lt; 2e-16 ***
## SurveyIdKH2005DHS  1.68112    0.07260  23.155  &lt; 2e-16 ***
## SurveyIdKH2010DHS  1.61671    0.06961  23.224  &lt; 2e-16 ***
## SurveyIdKH2014DHS  1.66621    0.06406  26.011  &lt; 2e-16 ***
## SurveyIdLS2004DHS  1.13997    0.07960  14.322  &lt; 2e-16 ***
## SurveyIdLS2009DHS  0.82962    0.07756  10.696  &lt; 2e-16 ***
## SurveyIdLS2014DHS  0.93593    0.08164  11.464  &lt; 2e-16 ***
## v025rural          0.11625    0.03220   3.610 0.000332 ***
## v106no education   0.15431    0.03845   4.013 6.75e-05 ***
## v106secondary     -0.11932    0.02787  -4.282 2.16e-05 ***
## v106higher        -0.33508    0.04985  -6.722 4.19e-11 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 0.99451)
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>The results suggest that anemia prevalence is lower among women with higher education.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://www.measureevaluation.org/prh/rh_indicators/womens-health/womens-nutrition/percent-of-women-of-reproductive-age-with-anemia" class="uri">https://www.measureevaluation.org/prh/rh_indicators/womens-health/womens-nutrition/percent-of-women-of-reproductive-age-with-anemia</a><a href="#fnref1">â†©</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#setup">Setup</a></li>
      <li><a href="#using-calculated-indicators-from-statcompiler">Using calculated indicators from STATcompiler</a></li>
      <li>
<a href="#analyse-dhs-microdata">Analyse DHS microdata</a><ul class="nav nav-pills nav-stacked">
<li><a href="#identify-surveys-that-include-anemia-testing">Identify surveys that include anemia testing</a></li>
      <li><a href="#download-datasets">Download datasets</a></li>
      <li><a href="#identify-survey-variables">Identify survey variables</a></li>
      <li><a href="#extract-survey-data">Extract survey data</a></li>
      <li><a href="#data-tabulations">Data tabulations</a></li>
      <li><a href="#calculate-anemia-prevalence">Calculate anemia prevalence</a></li>
      </ul>
</li>
      <li><a href="#regression-analysis-relationship-between-education-and-anemia">Regression analysis: relationship between education and anemia</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by OJ Watson, Jeff Eaton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
